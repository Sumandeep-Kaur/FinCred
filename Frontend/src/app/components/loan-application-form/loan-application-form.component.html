<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card border-0 shadow-lg overflow-hidden">
                <div class="card-header bg-primary text-white p-4 position-relative">
                    <h4 class="mb-0 fw-bold d-flex align-items-center">
                        <i class="bi bi-file-earmark-text me-3 fs-4"></i>
                        Fincred: Line of Credit 
                        <div class="ms-auto text-end">
                            <span class="badge bg-light text-primary px-3 py-2 rounded-pill">
                                Step {{currentStep}} of 3
                            </span>
                        </div>
                    </h4>
                </div>
                <div class="card-body p-4 position-relative">
                    <div class="mb-4">
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-primary" role="progressbar"
                                [style.width]="currentStep === 1 ? '33%' : currentStep === 2 ? '66%' : '100%'"
                                aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                            </div>
                        </div>
                    </div>

                    <form [formGroup]="applicationForm" (ngSubmit)="submitApplication()" class="needs-validation">
                        <!-- Error Message 
                        <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mt-3 shadow-sm"
                            role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            {{ errorMessage }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div> -->

                        <!-- Personal Information Step -->
                        <div *ngIf="currentStep === 1" class="row g-4">
                            <div class="col-12 mb-3">
                                <h5 class="text-primary border-bottom pb-2 mb-4">
                                    <i class="fas fa-user me-2"></i> Personal Information
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <label for="age" class="form-label fw-semibold">
                                    Age <span class="text-danger">*</span>
                                </label>

                                <!-- Apply is-valid and is-invalid to the entire input-group -->
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['age'].touched && f['age'].errors"
                                    [class.is-valid]="f['age'].touched && !f['age'].errors">

                                    <span class="input-group-text">
                                        <i class="fas fa-calendar"></i>
                                    </span>

                                    <input type="number" class="form-control border-start-0" id="age"
                                        formControlName="age" [class.is-invalid]="f['age'].touched && f['age'].errors"
                                        [class.is-valid]="f['age'].touched && !f['age'].errors">

                                    <div class="invalid-feedback" *ngIf="f['age'].touched && f['age'].errors">
                                        <div *ngIf="f['age'].errors['required']">Age is required</div>
                                        <div *ngIf="f['age'].errors['min']">Age must be at least 19</div>
                                        <div *ngIf="f['age'].errors['max']">Age must not exceed 100</div>
                                    </div>
                                </div>
                            </div>



                            <div class="col-md-6">
                                <label for="province" class="form-label fw-semibold">Province <span
                                        class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['province'].touched && f['province'].errors"
                                    [class.is-valid]="f['province'].touched && !f['province'].errors">
                                    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i> </span>
                                    <select class="form-select border-start-0" id="province" formControlName="province"
                                        [class.is-invalid]="f['province'].touched && f['province'].errors"
                                        [class.is-valid]="f['province'].touched && !f['province'].errors">
                                        <option value="">Select Province</option>
                                        <option *ngFor="let province of provinces" [value]="province.code">
                                            {{province.name}}
                                        </option>
                                    </select>
                                    <div class="invalid-feedback" *ngIf="f['province'].touched && f['province'].errors">
                                        <div *ngIf="f['province'].errors['required']">Province is required</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="employmentStatus" class="form-label fw-semibold">Employment Status <span
                                        class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['employmentStatus'].touched && f['employmentStatus'].errors"
                                    [class.is-valid]="f['employmentStatus'].touched && !f['employmentStatus'].errors">
                                    <span class="input-group-text"><i class="fas fa-briefcase"></i> </span>
                                    <select class="form-select border-start-0" id="employmentStatus"
                                        formControlName="employmentStatus"
                                        [class.is-invalid]="f['employmentStatus'].touched && f['employmentStatus'].errors"
                                        [class.is-valid]="f['employmentStatus'].touched && !f['employmentStatus'].errors">
                                        <option value="">Select Employment Status</option>
                                        <option value="Full-time">Full-time</option>
                                        <option value="Part-time">Part-time</option>
                                        <option value="Self-employed">Self-employed</option>
                                        <option value="Unemployed">Unemployed</option>
                                    </select>
                                    <div class="invalid-feedback"
                                        *ngIf="f['employmentStatus'].touched && f['employmentStatus'].errors">
                                        <div *ngIf="f['employmentStatus'].errors['required']">Employment status is
                                            required</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="monthsEmployed" class="form-label fw-semibold">Months at Current Job
                                    <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['monthsEmployed'].touched && f['monthsEmployed'].errors"
                                    [class.is-valid]="f['monthsEmployed'].touched && !f['monthsEmployed'].errors">
                                    <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                    <input type="number" class="form-control border-start-0" id="monthsEmployed"
                                        formControlName="monthsEmployed"
                                        [class.is-invalid]="f['monthsEmployed'].touched && f['monthsEmployed'].errors"
                                        [class.is-valid]="f['monthsEmployed'].touched && !f['monthsEmployed'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['monthsEmployed'].touched && f['monthsEmployed'].errors">
                                        <div *ngIf="f['monthsEmployed'].errors['required']">Months employed is required
                                        </div>
                                        <div *ngIf="f['monthsEmployed'].errors['min']">Months employed must be at least
                                            0</div>
                                        <div *ngIf="f['monthsEmployed'].errors['max']">Months employed must not exceed
                                            600</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Financial Information Step -->
                        <div *ngIf="currentStep === 2" class="row g-4">
                            <div class="col-12 mb-3">
                                <h5 class="text-primary border-bottom pb-2 mb-4">
                                    <i class="fas fa-coins me-2"></i>Financial Information
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <label for="annualIncome" class="form-label fw-semibold">Annual Income (CAD) <span
                                        class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['annualIncome'].touched && f['annualIncome'].errors"
                                    [class.is-valid]="f['annualIncome'].touched && !f['annualIncome'].errors">
                                    <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                                    <input type="number" class="form-control border-start-0" id="annualIncome"
                                        formControlName="annualIncome"
                                        [class.is-invalid]="f['annualIncome'].touched && f['annualIncome'].errors"
                                        [class.is-valid]="f['annualIncome'].touched && !f['annualIncome'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['annualIncome'].touched && f['annualIncome'].errors">
                                        <div *ngIf="f['annualIncome'].errors['required']">Annual income is required
                                        </div>
                                        <div *ngIf="f['annualIncome'].errors['min']">Annual income must be at least
                                            $20,000</div>
                                        <div *ngIf="f['annualIncome'].errors['max']">Annual income must not exceed
                                            $200,000</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="creditScore" class="form-label fw-semibold">Credit Score <span
                                        class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['creditScore'].touched && f['creditScore'].errors"
                                    [class.is-valid]="f['creditScore'].touched && !f['creditScore'].errors">
                                    <span class="input-group-text"><i class="fas fa-chart-line"></i> </span>
                                    <input type="number" class="form-control border-start-0" id="creditScore"
                                        formControlName="creditScore"
                                        [class.is-invalid]="f['creditScore'].touched && f['creditScore'].errors"
                                        [class.is-valid]="f['creditScore'].touched && !f['creditScore'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['creditScore'].touched && f['creditScore'].errors">
                                        <div *ngIf="f['creditScore'].errors['required']">Credit score is required
                                        </div>
                                        <div *ngIf="f['creditScore'].errors['min']">Credit score must be at least
                                            300</div>
                                        <div *ngIf="f['creditScore'].errors['max']">Credit score must not exceed 900
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="selfReportedDebt" class="form-label fw-semibold">Monthly Debt (CAD)
                                    <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['selfReportedDebt'].touched && f['selfReportedDebt'].errors"
                                    [class.is-valid]="f['selfReportedDebt'].touched && !f['selfReportedDebt'].errors">
                                    <span class="input-group-text"><i class="fas fa-credit-card"></i> </span>
                                    <input type="number" class="form-control border-start-0 " id="selfReportedDebt"
                                        formControlName="selfReportedDebt"
                                        [class.is-invalid]="f['selfReportedDebt'].touched && f['selfReportedDebt'].errors"
                                        [class.is-valid]="f['selfReportedDebt'].touched && !f['selfReportedDebt'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['selfReportedDebt'].touched && f['selfReportedDebt'].errors">
                                        <div *ngIf="f['selfReportedDebt'].errors['required']">Monthly debt is
                                            required</div>
                                        <div *ngIf="f['selfReportedDebt'].errors['min']">Monthly debt must be at
                                            least $0</div>
                                        <div *ngIf="f['selfReportedDebt'].errors['max']">Monthly debt must not
                                            exceed $10,000</div>
                                    </div>
                                </div>
                                <small class="form-text text-muted">Include rent, loans, etc.</small>
                            </div>

                            <div class="col-md-6">
                                <label for="selfReportedExpenses" class="form-label fw-semibold">Monthly Expenses (CAD)
                                    <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['selfReportedDebt'].touched && f['selfReportedDebt'].errors"
                                    [class.is-valid]="f['selfReportedDebt'].touched && !f['selfReportedDebt'].errors">
                                    <span class="input-group-text"><i class="fas fa-receipt"></i> </span>
                                    <input type="number" class="form-control border-start-0" id="selfReportedExpenses"
                                        formControlName="selfReportedExpenses"
                                        [class.is-invalid]="f['selfReportedExpenses'].touched && f['selfReportedExpenses'].errors"
                                        [class.is-valid]="f['selfReportedExpenses'].touched && !f['selfReportedExpenses'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['selfReportedExpenses'].touched && f['selfReportedExpenses'].errors">
                                        <div *ngIf="f['selfReportedExpenses'].errors['required']">Monthly expenses
                                            is required</div>
                                        <div *ngIf="f['selfReportedExpenses'].errors['min']">Monthly expenses must
                                            be at least $0</div>
                                        <div *ngIf="f['selfReportedExpenses'].errors['max']">Monthly expenses must
                                            not exceed $10,000</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="creditUtilization" class="form-label fw-semibold">Credit Utilization
                                    (%) <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['creditUtilization'].touched && f['creditUtilization'].errors"
                                    [class.is-valid]="f['creditUtilization'].touched && !f['creditUtilization'].errors">
                                    <span class="input-group-text"><i class="fas fa-receipt"></i> </span>
                                    <input type="number" class="form-control border-start-0" id="creditUtilization"
                                        formControlName="creditUtilization"
                                        [class.is-invalid]="f['creditUtilization'].touched && f['creditUtilization'].errors"
                                        [class.is-valid]="f['creditUtilization'].touched && !f['creditUtilization'].errors" />
                                </div>
                                <div class="invalid-feedback"
                                    *ngIf="f['creditUtilization'].touched && f['creditUtilization'].errors"
                                    class="text-danger small mt-1">
                                    <div *ngIf="f['creditUtilization'].errors['required']">Credit utilization is
                                        required</div>
                                    <div *ngIf="f['creditUtilization'].errors['min']">Credit utilization must be at
                                        least 0%</div>
                                    <div *ngIf="f['creditUtilization'].errors['max']">Credit utilization must not exceed
                                        100%</div>
                                </div>
                                <small class="form-text text-muted">Percentage of credit used.</small>
                            </div>

                            <div class="col-md-6">
                                <label for="totalCreditLimit" class="form-label fw-semibold">Current Credit Limit (CAD)
                                    <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['totalCreditLimit'].touched && f['totalCreditLimit'].errors"
                                    [class.is-valid]="f['totalCreditLimit'].touched && !f['totalCreditLimit'].errors">
                                    <span class="input-group-text"><i class="fas fa-receipt"></i> </span>
                                    <input type="number" class="form-control border-start-0" id="totalCreditLimit"
                                        formControlName="totalCreditLimit"
                                        [class.is-invalid]="f['totalCreditLimit'].touched && f['totalCreditLimit'].errors"
                                        [class.is-valid]="f['totalCreditLimit'].touched && !f['totalCreditLimit'].errors" />
                                </div>
                                <div class="invalid-feedback"
                                    *ngIf="f['totalCreditLimit'].touched && f['totalCreditLimit'].errors"
                                    class="text-danger small mt-1">
                                    <div *ngIf="f['totalCreditLimit'].errors['required']">Current credit
                                        limit is required</div>
                                    <div *ngIf="f['totalCreditLimit'].errors['min']">Current credit limit
                                        must be at least $0</div>
                                    <div *ngIf="f['totalCreditLimit'].errors['max']">Current credit limit
                                        must not exceed $50,000</div>
                                </div>
                            </div>
                        </div>

                        <!-- Credit Information Step -->
                        <div *ngIf="currentStep === 3" class="row g-4">
                            <div class="col-12 mb-3">
                                <h5 class="text-primary border-bottom pb-2 mb-4">
                                    <i class="fas fa-credit-card me-2"></i>Credit Information & Request
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <label for="numOpenAccounts" class="form-label fw-semibold">Number of Open Accounts
                                    <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['numOpenAccounts'].touched && f['numOpenAccounts'].errors"
                                    [class.is-valid]="f['numOpenAccounts'].touched && !f['numOpenAccounts'].errors">
                                    <span class="input-group-text"><i class="fas fa-list-ol"></i></span>
                                    <input type="number" class="form-control border-start-0" id="numOpenAccounts"
                                        formControlName="numOpenAccounts"
                                        [class.is-invalid]="f['numOpenAccounts'].touched && f['numOpenAccounts'].errors"
                                        [class.is-valid]="f['numOpenAccounts'].touched && !f['numOpenAccounts'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['numOpenAccounts'].touched && f['numOpenAccounts'].errors">
                                        <div *ngIf="f['numOpenAccounts'].errors['required']">Number of open accounts
                                            is required</div>
                                        <div *ngIf="f['numOpenAccounts'].errors['min']">Must be at least 0</div>
                                        <div *ngIf="f['numOpenAccounts'].errors['max']">Must not exceed 20</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="numCreditInquiries" class="form-label fw-semibold">Credit Inquiries
                                    (Last 12 months) <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['numCreditInquiries'].touched && f['numCreditInquiries'].errors"
                                    [class.is-valid]="f['numCreditInquiries'].touched && !f['numCreditInquiries'].errors">
                                    <span class="input-group-text"><i class="fas fa-search-dollar"></i></span>
                                    <input type="number" class="form-control border-start-0" id="numCreditInquiries"
                                        formControlName="numCreditInquiries"
                                        [class.is-invalid]="f['numCreditInquiries'].touched && f['numCreditInquiries'].errors"
                                        [class.is-valid]="f['numCreditInquiries'].touched && !f['numCreditInquiries'].errors" />
                                    <div class="invalid-feedback"
                                        *ngIf="f['numCreditInquiries'].touched && f['numCreditInquiries'].errors">
                                        <div *ngIf="f['numCreditInquiries'].errors['required']">Number of credit
                                            inquiries is required</div>
                                        <div *ngIf="f['numCreditInquiries'].errors['min']">Must be at least 0</div>
                                        <div *ngIf="f['numCreditInquiries'].errors['max']">Must not exceed 10</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="paymentHistory" class="form-label fw-semibold">Payment History <span
                                        class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['paymentHistory'].touched && f['paymentHistory'].errors"
                                    [class.is-valid]="f['paymentHistory'].touched && !f['paymentHistory'].errors">
                                    <span class="input-group-text"><i class="fas fa-history"></i></span>
                                    <select class="form-select border-start-0" id="paymentHistory"
                                        formControlName="paymentHistory" [class.is-invalid]="f['paymentHistory'].touched && f['paymentHistory'].errors"
                                        [class.is-valid]="f['paymentHistory'].touched && !f['paymentHistory'].errors">
                                        <option value="">Select Payment History</option>
                                        <option value="On Time">On Time</option>
                                        <option value="Late <30">Late &lt;30 Days</option>
                                        <option value="Late 30-60">Late 30-60 Days</option>
                                        <option value="Late >60">Late &gt;60 Days</option>
                                    </select>
                                </div>
                                <div class="invalid-feedback"
                                    *ngIf="f['paymentHistory'].touched && f['paymentHistory'].errors">
                                    <div *ngIf="f['paymentHistory'].errors['required']">Payment history is
                                        required</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="monthlyExpenses" class="form-label fw-semibold">Monthly Credit Spending
                                    (CAD) <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['monthlyExpenses'].touched && f['monthlyExpenses'].errors"
                                    [class.is-valid]="f['monthlyExpenses'].touched && !f['monthlyExpenses'].errors">
                                    <span class="input-group-text"><i class="fas fa-wallet"></i></span>
                                    <input type="number" class="form-control border-start-0" id="monthlyExpenses"
                                        formControlName="monthlyExpenses"
                                        [class.is-invalid]="f['monthlyExpenses'].touched && f['monthlyExpenses'].errors"
                                        [class.is-valid]="f['monthlyExpenses'].touched && !f['monthlyExpenses'].errors">
                                    <div class="invalid-feedback"
                                        *ngIf="f['monthlyExpenses'].touched && f['monthlyExpenses'].errors">
                                        <div *ngIf="f['monthlyExpenses'].errors['required']">Monthly credit spending
                                            is required</div>
                                        <div *ngIf="f['monthlyExpenses'].errors['min']">Must be at least $0</div>
                                        <div *ngIf="f['monthlyExpenses'].errors['max']">Must not exceed $10,000
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <label for="requestedAmount" class="form-label fw-semibold">Requested Credit Amount
                                    (CAD) <span class="text-danger">*</span></label>
                                <div class="input-group has-validation"
                                    [class.is-invalid]="f['requestedAmount'].touched && f['requestedAmount'].errors"
                                    [class.is-valid]="f['requestedAmount'].touched && !f['requestedAmount'].errors">
                                    <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                                    <input type="number" class="form-control border-start-0" id="requestedAmount"
                                        formControlName="requestedAmount" [class.is-invalid]="f['requestedAmount'].touched && f['requestedAmount'].errors"
                                        [class.is-valid]="f['requestedAmount'].touched && !f['requestedAmount'].errors">
                                </div>
                                <div class="invalid-feedback"
                                    *ngIf="f['requestedAmount'].touched && f['requestedAmount'].errors">
                                    <div *ngIf="f['requestedAmount'].errors['required']">Requested amount is
                                        required</div>
                                    <div *ngIf="f['requestedAmount'].errors['min']">Must be at least $1,000
                                    </div>
                                    <div *ngIf="f['requestedAmount'].errors['max']">Must not exceed $50,000
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 mt-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="termsCheck"
                                        formControlName="terms">
                                    <label class="form-check-label" for="termsCheck">
                                        I confirm that all information provided is accurate to the best of my
                                        knowledge.
                                    </label>
                                    <div *ngIf="formSubmitted && f['terms'].errors?.['required']"
                                        class="text-danger small mt-2">
                                        You must agree to the terms to proceed
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="d-flex justify-content-between mt-5">
                            <button *ngIf="currentStep > 1" type="button"
                                class="btn btn-outline-primary rounded-pill px-4 py-2 d-flex align-items-center"
                                (click)="prevStep()">
                                <i class="fas fa-arrow-left me-2"></i>Previous
                            </button>
                            <div class="ms-auto">
                                <button *ngIf="currentStep < 3" type="button"
                                    class="btn btn-primary rounded-pill px-4 py-2 d-flex align-items-center"
                                    (click)="nextStep()">
                                    Next <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                                <button *ngIf="currentStep === 3" type="submit"
                                    class="btn btn-success rounded-pill px-4 py-2 d-flex align-items-center"
                                    [disabled]="isSubmitting">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <span *ngIf="!isSubmitting">Submit Application</span>
                                    <span *ngIf="isSubmitting">
                                        <span class="spinner-border spinner-border-sm me-2" role="status"
                                            aria-hidden="true"></span>
                                        Processing...
                                    </span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>